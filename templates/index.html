<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/theme/ayu-mirage.css">
    <title>Transcompile</title>
    <style>
        h1 {
            font-family: Arial;
            color: #409EFF;
        }

        .CodeMirror {
            height: 240px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/addon/edit/matchbrackets.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-codemirror@4.0.0/dist/vue-codemirror.js"></script>
    <script src="../CssJs/placeholder.js"></script>
    <!-- import Vue before Element -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- import JavaScript -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- import axios (a http library) -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>

<body>
    <div style="text-align: center;">
        <h1>Welcome to our transcompile website</h1>
    </div>



    <el-button type="primary" id="compile" style="margin: 5px;" @click="compileCode">编译/运行</el-button>
    <!-- <el-input type="submit" value="编译/运行" style="margin: 5px;width: 10%;" id='submit'>
        </el-input> -->
    <template id="select">
        <el-select v-model="value" placeholder="请选择代码语言">
            <el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
            </el-option>
        </el-select>
    </template>
    <el-button type="primary" id="transform" style="margin: 5px;" @click="transformCode">转换代码</el-button>

    <template id="transform_select">
        <el-select v-model="value" placeholder="请选择目标代码语言">
            <el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value">
            </el-option>
        </el-select>
    </template>
    <br />
    <codemirror v-model="textarea" id="code" style="width: 40%; display: inline-block; margin-right: 10%;"
        :options="cmOption"></codemirror>
    <!-- <el-input type="textarea" :rows="10" v-model="textarea" id='result' style="width: 40%;margin-left: 10%;" placeholder="编译/运行结果">
    </el-input> -->
    <codemirror v-model="textarea" id="result" style="width: 40%; display: inline-block;" :options="cmOption">
    </codemirror>

    <br />

    <el-button type="primary" id="compile2" style="margin: 5px;" @click="compileCode">编译/运行</el-button>
    <!-- <el-input type="submit" value="编译/运行" style="margin: 5px;width: 10%;" id='submit'>
        </el-input> -->
    <br />
    <!-- <el-input type="textarea" :rows="10" v-model="textarea" id='code2' style="width: 40%;" placeholder="转换后的代码">
    </el-input> -->
    <codemirror v-model="textarea" id="code2" style="width: 40%; display: inline-block; margin-right: 10%;"
        :options="cmOption"></codemirror>
    <!-- <el-input type="textarea" :rows="10" v-model="textarea" id='result2' style="width: 40%;margin-left: 10%;"
        placeholder="编译/运行结果">
    </el-input> -->
    <codemirror v-model="textarea" id="result2" style="width: 40%; display: inline-block;" :options="cmOption">
    </codemirror>
</body>

</html>

<script>
    Vue.use(VueCodemirror);

    var defaultCpp = String.raw `#include <bits/stdc++.h>
using namespace std;

void my_function() {
  // Enter or paste your code here
}

int main(){
  my_function();
  return 0;
}
`;

    var defaultPython = String.raw`# import any needed libraries here
def my_function():
  # Enter or paste your code here

my_function()
`;

    var defaultJava = String.raw`// import any needed libraries here

public class MyJavaClass {

    private static void my_function() {
        // Enter or paste your code here
    }

    public static void main(String[] args) {
        my_function();
    }
}
`;
    const themeName = 'ayu-mirage';

    var source = new Vue({
        el: '#code',
        data: {
            textarea: '',
            cmOption: {
                tabSize: 4,
                styleActiveLine: true,
                lineNumbers: true,
                mode: 'text/x-c++src',
                theme: themeName,
                matchBrackets: true,
            }
        }
    });

    var compile = new Vue({
        el: '#compile',
        methods: {
            compileCode: function () {
                var sourceCode = source.textarea;
                console.log(sourceCode);
                axios({
                    method: 'post',
                    url: '/compile/',
                    data: {
                        code: sourceCode,
                        language: select.value,
                    }
                }).then(function (response) {
                    console.log(response);
                    source.textarea = response.data.source;
                    result.textarea = response.data.result;
                }).catch(function (error) {
                    console.log(error);
                });
            }
        },
    });

    var select = new Vue({
        el: '#select',
        data: {
            options: [{
                    value: 'python',
                    label: 'python'
                },
                {
                    value: 'cpp',
                    label: 'c++'
                },
                {
                    value: 'java',
                    label: 'java'
                },
            ],
            value: ''
        },
        watch: {
            value: function (newValue) {
                if (newValue == "cpp") {
                    source.cmOption.mode = "text/x-c++src";
                    source.textarea = defaultCpp;
                } else if (newValue == "python") {
                    source.cmOption.mode = "text/x-python";
                    source.textarea = defaultPython;
                } else if (newValue == "java") {
                    source.cmOption.mode = "text/x-java";
                    source.textarea = defaultJava;
                }
            }
        },
    });

    var transform = new Vue({
        el: '#transform',
        methods: {
            transformCode: function () {
                var sourceCode = source.textarea;
                // console.log(sourceCode);
                axios({
                    method: 'post',
                    url: '/transform/',
                    data: {
                        code: sourceCode,
                        source_language: select.value,
                        target_language: transform_select.value,
                    }
                }).then(function (response) {
                    console.log(response);
                    source.textarea = response.data.source;
                    source2.textarea = response.data.result;
                }).catch(function (error) {
                    console.log(error);
                });
            }
        },
    });

    var transform_select = new Vue({
        el: '#transform_select',
        data: {
            options: [{
                    value: 'python',
                    label: 'python'
                },
                {
                    value: 'cpp',
                    label: 'c++'
                },
                {
                    value: 'java',
                    label: 'java'
                },
            ],
            value: ''
        },
        watch: {
            value: function (newValue) {
                if (newValue == "cpp") {
                    source2.cmOption.mode = "text/x-c++src";
                } else if (newValue == "python") {
                    source2.cmOption.mode = "text/x-python";
                } else if (newValue == "java") {
                    source2.cmOption.mode = "text/x-java";
                }
            }
        },
    });

    var result = new Vue({
        el: '#result',
        data: {
            textarea: '',
            cmOption: {
                tabSize: 4,
                styleActiveLine: true,
                lineNumbers: true,
                mode: 'text/x-c++src',
                theme: themeName,
                matchBrackets: true,
            }
        }
    });


    var compile2 = new Vue({
        el: '#compile2',
        methods: {
            compileCode: function () {
                var sourceCode = source2.textarea;
                // console.log(sourceCode);
                axios({
                    method: 'post',
                    url: '/compile/',
                    data: {
                        code: sourceCode,
                        language: transform_select.value,
                    }
                }).then(function (response) {
                    console.log(response);
                    source2.textarea = response.data.source;
                    result2.textarea = response.data.result;
                }).catch(function (error) {
                    console.log(error);
                });
            }
        },
    });

    var source2 = new Vue({
        el: '#code2',
        data: {
            textarea: '',
            cmOption: {
                tabSize: 4,
                styleActiveLine: true,
                lineNumbers: true,
                mode: 'text/x-c++src',
                theme: themeName,
                matchBrackets: true,
            }
        }
    });

    var result2 = new Vue({
        el: '#result2',
        data: {
            textarea: '',
            cmOption: {
                tabSize: 4,
                styleActiveLine: true,
                lineNumbers: true,
                mode: 'text/x-c++src',
                theme: themeName,
                matchBrackets: true,
            }
        }
    });
</script>